function SVG2Bitmap(e,t,n){"use strict";if(n||(n={}),(!n.scale||n.scale<0)&&(n.scale=1),!e||!e.nodeName)return void console.error("Wrong arguments : should be \n SVG2Bitmap(SVGElement, function([canvasElement],[dataURL]) || IMGElement || CanvasElement [, {parameters})");var r,a=function(){this.removeEventListener("load",a),SVG2Bitmap(this,t,n)};if("OBJECT"===e.nodeName||"IFRAME"===e.nodeName){if(!e.contentDocument||"complete"===e.contentDocument.readyState&&!e.contentDocument.documentElement)return void console.error("Unable to access the svg node : make sure it comes from the same domain or that the container has finished loading");if("complete"!==e.contentDocument.readyState)return void e.addEventListener("load",a);r=e,e=e.contentDocument.documentElement}else if("EMBED"===e.nodeName&&e.getSVGDocument&&(r=e,e=e.getSVGDocument(),!e))return r.addEventListener("load",a),r.onerror=function(){console.error("Unable to access the svg node : make sure it comes from the same domain or that the container has finished loading")},void(r.src=r.src);if("svg"!==e.nodeName&&(e=e.querySelector("svg"),!e))return void console.error("unable to access the svg node, make sure it has been appended to the document");var o,i="http://www.w3.org/1999/xlink",l="http://www.w3.org/2000/svg",s=e.cloneNode(!0),c=function(){o=s.querySelector("defs")||document.createElementNS(l,"defs"),o.parentNode||s.insertBefore(o,s.firstElementChild)},h=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=e.height=1;var n=function(n){var r=!1;t.drawImage(n,0,0);try{e.toDataURL()}catch(a){r=!0,e=e.cloneNode(!0),t=e.getContext("2d")}return r},r=document.implementation.createHTMLDocument("test"),a=document.createElement("base");r.head.appendChild(a);var o=document.createElement("a");r.body.appendChild(o);var i=function(e,t){return a.href=t,o.href=e,o};return{isTainted:n,URL:i}}(),u=!1,d=function(){var a=r?r.getBoundingClientRect():e.getBoundingClientRect();1!==e.width.baseVal.unitType&&s.setAttribute("width",a.width),1!==e.height.baseVal.unitType&&s.setAttribute("height",a.height);var o=(new XMLSerializer).serializeToString(s),i="data:image/svg+xml; charset=utf8, "+encodeURIComponent(o),l=new Image,c=function(){var o=t&&"CANVAS"===t.nodeName?t:document.createElement("canvas");if(o.originalSVG=r||e,o.width=a.width*n.scale,o.height=a.height*n.scale,!o.width||!o.height)return void console.error("The document is not visible and can not be rendered");var i=o.getContext("2d");n.backgroundColor&&(i.fillStyle=n.backgroundColor,i.fillRect(0,0,o.width,o.height));var s,c=n.scale;return s=r?e.getBoundingClientRect():{top:0,left:0},i.drawImage(l,s.left,s.top,this.width*c||o.width,this.height*c||o.height),t||(t=function(t){var n=r||e;n.parentNode.replaceChild(t,n)}),h.isTainted(o)?(console.warn("Your browser has tainted the canvas.\n The canvas is returned"),void("IMG"===t.nodeName?t.parentNode.replaceChild(o,t):"function"==typeof t&&t(o,null))):void("IMG"===t.nodeName?(t.setAttribute("style",f(t)),t.src=o.toDataURL()):(o.setAttribute("style",f(o)),t!==o&&t.appendChild?t.appendChild(o):"function"==typeof t&&t(o,o.toDataURL())))},m=function(t){if(u)return void console.error("Couldn't export svg, please check that the svgElement passed is a valid svg document.");var n=function(e){for(var t=e.attributes,n=0;n<t.length;n++)t[n].name.indexOf(":")>-1&&0!==t[n].name.indexOf("xlink")&&e.removeAttribute(t[n].name)};n(e);for(var r=0;r<s.children.length;r++)n(s.children[r]);u=!0,d()};l.onload=c,l.onerror=m,l.src=i},m=function(){var t,n=[],r=[],a=e.ownerDocument.styleSheets;for(t=0;t<a.length;t++)r.push(a[t]);for(r.length&&(c(),e.matches=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector),t=0;t<r.length;t++)if(r[t].ownerNode.ownerSVGElement!==e){var i;try{i=r[t].cssRules}catch(l){continue}for(var u=document.createElement("style"),d=i.length,m=0;d>m;m++){var f=i[m].selectorText;if(e.matches&&e.matches(f)||e.querySelector(f)){var v=i[m].cssText,p=v.match(/url\((.*)\)/);if(p&&p.length>1){var w=p[1].replace(/\"/g,""),E=r[t].href||location.href;n.push([w,E]);var b=h.URL(w,E),S=b.href.substring(b.href.lastIndexOf("/")+1),N="#"+S.replace(/\//g,"_").replace(/\./g,"_").replace("#","_");v=v.replace(w,N)}u.innerHTML+=v+"\n"}}u.innerHTML&&o.appendChild(u)}var C=s.style;C.border=C.padding=C.margin=0,C.transform="initial",g(n)},f=function(t){var n=t.cloneNode(!0);e.parentNode.documentElement?e.parentNode.documentElement.appendChild(n):e.parentNode.insertBefore(n,e);for(var a=getComputedStyle(n),o=getComputedStyle(r||e),i="",l=0;l<o.length;l++)"width"!==o[l]&&"height"!==o[l]&&o[o[l]]!==a[o[l]]&&(i+=o[l]+":"+o[o[l]]+";");return n.parentNode.removeChild(n),i},v=function(){var t,r=s.querySelectorAll("image"),a=r.length,o=0;if(0===a)return void d();var l=[],c=e.querySelectorAll("image");for(t=0;t<r.length;t++)if(c[t]&&c[t].isEqualNode(r[t]))l.push(c[t]);else{for(var u=null,m=0;m<c.length;m++)if(c[m].isEqualNode(r[t])){u=c[m];break}l.push(u)}var f=function(e,t,n){var r=e.width,a=e.height,o=t.width,i=t.height,l=function(e){var t=a/r,n=i/o,l=n>t?o:i/t,s=n>t?o*t:i,u=function(e,t,n){var r=Math.max(t,n),a=Math.min(t,n);switch(e){case"Min":return 0;case"Mid":return(r-a)/2;case"Max":return r-a;default:return"invalid"}},d=[c,0,0,r,a,u(e[0],l,o),u(e[1],s,i),l,s];return"invalid"===d[5]||"invalid"===d[6]?h:d},s=function(e){var t,n,l=function(){t=o,n=a*o/r},s=function(){t=r*i/a,n=i};o>i?(l(),i>n&&s()):o===i?r>a?s():l():(s(),o>t&&l());var u=function(e,t,n,r){switch(e){case"Min":return 0;case"Mid":return(t-n)/2*r/t;case"Max":return(t-n)*r/t;default:return"invalid"}},d=u(e[0],t,o,r),m=u(e[1],n,i,a),f=[c,d,m,r-d,a-m,0,0,t-d*(t/r),n-m*(n/a)];return"invalid"===f[1]||"invalid"===f[2]?h:f},c="IMG"===e.nodeName||"VIDEO"===e.nodeName||"CANVAS"===e.nodeName?e:null,h=l(["Mid","Mid"]);if(!n)return h;var u=n.trim().split(" "),d=u[0].replace("x","").split("Y");switch(u[u.length-1]){case"meet":return l(d);case"slice":return s(d);default:return h}},v=document.createElement("canvas"),g=v.getContext("2d"),p=function(e){var t=new Image;t.onload=function(){++o===a&&d()},t.src=e},w=function(e,t){var r=new Image,l=function(){console.warn("failed to load an image at : ",r.src),n.keepImageHolder||e.parentNode.removeChild(e),--a===o&&d()};n.noCORS||(r.crossOrigin="Anonymous"),r.onload=function(){var r,a;if(t&&(r=e.getAttribute("preserveAspectRatio"),a=t.getBoundingClientRect()),t&&a&&(a.width*n.scale<this.width||a.height*n.scale<this.height)){v.width=a.width*n.scale,v.height=a.height*n.scale;var o=f(this,v,r);g.drawImage.apply(g,o)}else v.width=this.width,v.height=this.height,g.drawImage(this,0,0);if(h.isTainted(v))return void l();var s=v.toDataURL();e.setAttributeNS(i,"href",s),p(s)},r.onerror=function(){var e=this.src;this.onerror=l,this.removeAttribute("crossorigin"),this.src="",this.src=e},r.src=e.getAttributeNS(i,"href")},E=function(e,t){var n=new XMLHttpRequest;n.onload=function(){if(200===this.status){var e=this.responseText||this.response,n="data:image/svg+xml; charset=utf8, "+encodeURIComponent("<svg"+e.split("<svg")[1]);t.setAttributeNS(i,"href",n),p(n)}else w(t)},n.onerror=function(){w(t)};try{n.open("GET",e)}catch(r){return void w(t)}n.send()};for(t=0;t<r.length;t++){var b=r[t].getAttributeNS(i,"href");if(b.indexOf("data:image")<0)b.indexOf(".svg")>0?E(b,r[t]):w(r[t],l[t]);else if(++o===a)return void d()}},g=function(t){var n,r=0,a=0,u={href:location.href,pathname:location.pathname,filename:"",innerElements:[],parsedElements:[],doc:e.ownerDocument},d=[u],m=function(){var e=document.createElementNS(l,"use");e.setAttributeNS(i,"href","#__#"),s.appendChild(e);var t=!!s.querySelector('[*|href*="#"]');return s.removeChild(e),t}(),f=function(e){return m?e.querySelectorAll('[*|href*="#"]'):function(){var t=[],r=e.querySelectorAll("*");for(n=0;n<r.length;n++){var a=r[n].getAttributeNS(i,"href");a&&a.indexOf("#")>-1&&t.push(r[n])}return t}()},g=function(e){var t=["style","clip-path","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],n="[*|"+t.join('*="url"], *[*|')+'*="url"]',r=e.querySelectorAll(n);return r},p=function(e,t){var n,r=[],a=function(e,n){var r={};r.element=e,r.type=n,r.attributes=[],r.requestedElements=[],r.parentDoc=t;var a;if("xl"===n)a=e.attributes["xlink:href"],r.attributes.push(a),r.requestedElements.push(a.value);else{a=e.attributes;for(var o=0;o<a.length;o++){var i=a[o].value.match(/url\((.*)\)/);i&&i.length>1&&(r.attributes.push(a[o]),r.requestedElements.push(i[1].replace(/"/g,"")))}}return r},o=f(e),i=g(e);for(n=0;n<o.length;n++)r.push(new a(o[n],"xl"));for(n=0;n<i.length;n++)r.push(new a(i[n],"url"));var l=e.attributes;for(n=0;n<l.length;n++){var s=l[n];if("xlink:href"===s.name)r.push(new a(e,"xl"));else{var c=s.value.match(/url\((.*)\)/);c&&c.length>1&&r.push(new a(e,"url"))}}return r};d[0].base=location.href;var w=function(e,t){for(var n=e.querySelectorAll("image"),r=0;r<n.length;r++){var a=n[r].getAttributeNS(i,"href"),o=h.URL(a,t).href;a!==o&&n[r].setAttributeNS(i,"href",o)}},E=function(){var e;for(e=0;e<d.length;e++){var t=d[e];if(t.doc){var n=t.innerElements;if(n.length!==t.parsedElements.length){var i;for(i=0;i<n.length;i++){var l=t.doc.getElementById(n[i]);if(l){var s=l.cloneNode(!0);s.id=t.filename+"_"+n[i],w(s,t.base),o.appendChild(s),N(p(s,t)),t.parsedElements.push(n[i]),r--}else console.warn("Couldn't find this element",n[i]),r--}}}}a||r||v()},b=function(e){var t=e.href,n=new XMLHttpRequest;n.onload=function(){if(200===this.status){var n=this.responseText||this.response;if(!n)return;try{e.doc=(new DOMParser).parseFromString(n,"text/html")}catch(o){e.doc=document.implementation.createHTMLDocument(e.filename),e.doc.body.innerHTML=n}e.base=t}else e.doc=null,r-=e.innerElements.length,console.warn("could not load this external document :",t,"\nThose elements are lost : ",e.innerElements.join(" , "));--a||E()},n.onerror=function(n){e.doc=null,r-=e.innerElements.length,console.warn("could not load this external document",t),console.warn("Those elements are lost : ",e.innerElements.join(" , ")),--a||E()},n.open("GET",t),n.send()},S=function(e,t){for(var n=h.URL(e,t.base),o=n.href.substring(n.href.lastIndexOf("/")+1).replace(n.hash,""),i=o.replace(/\./g,"_"),l=n.hash.replace("#",""),c=n.href.replace(n.hash,""),u=i+"_"+l,m=0;m<d.length;m++){var f=d[m];if(f.href===c){if(0===m){if(s.getElementById(l))return l;u="_"+l}return f.innerElements.indexOf(l)<0?(null!==f.doc?r++:console.warn("this element is also lost ",l),f.innerElements.push(l),u):u}}r++,a++;var v={href:c,filename:i,innerElements:[l],parsedElements:[]};return d.push(v),b(v),u},N=function(e){e.length&&!o&&c();var t,n;for(t=0;t<e.length;t++){var r=e[t];for(n=0;n<r.requestedElements.length;n++){var a=r.requestedElements[n],i="#"+S(a,r.parentDoc),l=r.attributes[n],s=l.value.replace(a,i),h=l.name.toUpperCase()===l.name?l.name.toLowerCase():l.name;r.element.setAttribute(h,s)}}};for(n=0;n<t.length;n++)S(t[n][0],{base:t[n][1]});N(p(s,d[0])),a||(r?E():v())};m()}